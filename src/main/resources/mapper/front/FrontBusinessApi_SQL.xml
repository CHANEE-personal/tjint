<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tjint.springboot.app.api.business.service.impl.FrontBusinessApiMapper">

    <select id="getBrandList" parameterType="hashMap" resultType="hashMap">
        /*[FrontBusinessApi.xml].[getBrandList] */
        SELECT
        a.brand_seq           as brandSeq
        , a.category_cd       as categoryCd
        , (select code_name from app_code where code_id = a.category_cd) categoryName
        , a.menu_category_cd  as menuCategoryCd
        , a.menu_category_nm  as menuCategoryNm
        , a.brand_name        as brandName
        , a.brand_description as brandDescription
        , a.visible           as visible
        , a.creator           as creator
        , (SELECT name from app_user_info where user_seq = creator) as creatorNm
        , DATE_FORMAT(a.create_time, '%Y.%m.%d')       as createTime
        , a.updater           as updater
        , (SELECT name from app_user_info where user_seq = updater) as updaterNm
        , DATE_FORMAT(a.update_time, '%Y.%m.%d')       as updateTime
        , b.image_file_info_seq as imageFileInfoSeq
        , c.FILE_NAME         as imageFileName
        , d.link_seq          as linkSeq
        , d.link_address      as linkAddress
        , d.visible           as brandLinkVisible
        FROM app_board_brand a
        LEFT OUTER JOIN app_image_file_info b ON a.brand_seq = b.board_seq
        AND b.board_type_cd = 'brdt001'
        AND b.image_type_cd = 'imgt001'
        LEFT OUTER JOIN J_ATTACHFILE c ON b.image_file_id = c.FILE_ID
        LEFT OUTER JOIN app_url_link_info d ON a.brand_seq = d.board_seq
        AND d.board_type_cd = 'brdt001'
        AND d.link_type_cd = 'lnkt001'
        <where>
            a.visible = 'Y'
            <if test="brandSeq != null and brandSeq != ''">AND a.brand_seq = #{brandSeq}</if>
            <if test="menuCd != null and menuCd != ''">
                AND a.menu_category_cd = #{menuCd}
            </if>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND a.brand_name LIKE CONCAT ('%', #{searchKeyword},'%')
            </if>
        </where>

        ORDER BY brand_seq DESC
    </select>

    <select id="frontNewsInfo" parameterType="newNewsDto" resultType="java.util.HashMap">
        /*[AdminPrMgmt_SQL.xml].[getNewsInfo] */
        <![CDATA[
        SELECT news_seq,
               news_title,
               news_description,
               A.visible,
               A.creator,
               A.create_time,
               A.updater,
               A.update_time,
               B.image_file_id as imageFileId,
               C.FILE_NAME     as fileName,
               C.FILE_PATH     as filePath
        FROM app_board_news A
                 left OUTER JOIN
             (select * from app_image_file_info where board_type_cd = 'brdt002' AND visible = 'Y') B
             ON A.news_seq = B.board_seq
                 left outer join
             J_ATTACHFILE C
             on B.image_file_id = C.file_id
        WHERE news_seq = #{newsSeq}
        ]]>

    </select>

    <select id="frontNewsListCnt" parameterType="hashMap" resultType="Integer">
        /*[AdminPrMgmt_SQL.xml].[selectNewsListCnt] */
        <![CDATA[
            SELECT
                COUNT(*) AS TOT
            FROM
                app_board_news
            where visible != 'Y'
        ]]>
        <choose>
            <when test="searchCondition == 0">
                <![CDATA[ AND news_title LIKE CONCAT ('%', #{searchKeyword},'%')         ]]>
            </when>
            <when test="searchCondition == 1">
                <![CDATA[ AND news_description LIKE CONCAT ('%', #{searchKeyword},'%')         ]]>
            </when>
        </choose>
    </select>

</mapper>
