<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tjint.springboot.app.admin.brand.service.impl.AdminBrandMapper">
    <select id="getBrandList" parameterType="brandInfoVo" resultType="brandInfoVo">
        /* [AdminBrand_SQL.xml].[getBrandList] */
        SELECT
        a.brand_seq           as brandSeq
        , a.category_cd       as categoryCd
        , (select code_name from app_code where code_id = a.category_cd) categoryName
        , a.menu_category_cd  as menuCategoryCd
        , a.menu_category_nm  as menuCategoryNm
        , a.brand_name        as brandName
        , a.brand_description as brandDescription
        , a.visible           as visible
        , a.creator           as creator
        , (SELECT name from app_user_info where user_seq = creator) as creatorNm
        , DATE_FORMAT(a.create_time, '%Y.%m.%d')       as createTime
        , a.updater           as updater
        , (SELECT name from app_user_info where user_seq = updater) as updaterNm
        , DATE_FORMAT(a.update_time, '%Y.%m.%d')       as updateTime
        , b.image_file_info_seq as imageFileInfoSeq
        , c.FILE_NAME         as imageFileName
        , d.link_seq          as linkSeq
        , d.link_address      as linkAddress
        , d.visible           as brandLinkVisible
        FROM app_board_brand a
        LEFT OUTER JOIN app_image_file_info b ON a.brand_seq = b.board_seq
        AND b.board_type_cd = 'brdt001'
        AND b.image_type_cd = 'imgt001'
        LEFT OUTER JOIN J_ATTACHFILE c ON b.image_file_id = c.FILE_ID
        LEFT OUTER JOIN app_url_link_info d ON a.brand_seq = d.board_seq
        AND d.board_type_cd = 'brdt001'
        AND d.link_type_cd = 'lnkt001'
        <where>
            a.visible != 'D'
            <if test="brandSeq != null and brandSeq != ''">AND a.brand_seq = #{brandSeq}</if>
            <if test="categoryCd != null and categoryCd != ''">
                AND a.category_cd = #{categoryCd}
            </if>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND a.brand_name LIKE CONCAT ('%', #{searchKeyword},'%')
            </if>
        </where>

        ORDER BY brand_seq DESC
    </select>

    <select id="getBrandListCnt" parameterType="brandInfoVo" resultType="Integer">
        /* [AdminBrand_SQL.xml].[getBrandList] */
        SELECT
        count(*) as total
        FROM app_board_brand a
        LEFT OUTER JOIN app_image_file_info b ON a.brand_seq = b.board_seq
        AND b.board_type_cd = 'brdt001'
        AND b.image_type_cd = 'imgt001'
        LEFT OUTER JOIN J_ATTACHFILE c ON b.image_file_id = c.FILE_ID
        LEFT OUTER JOIN app_url_link_info d ON a.brand_seq = d.board_seq
        AND d.board_type_cd = 'brdt001'
        AND d.link_type_cd = 'lnkt001'
        <where>
            a.visible != 'D'
            <if test="categoryCd != null and categoryCd != ''">
                AND a.category_cd = #{categoryCd}
            </if>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND a.brand_name LIKE CONCAT ('%', #{searchKeyword},'%')
            </if>
        </where>
    </select>


    <update id="modifyBrand" parameterType="brandInfoVo">
        /* [AdminBrand_SQL.xml].[modifyBrand] */
        UPDATE app_board_brand
        SET
        <if test="categoryCd != null and categoryCd != ''">category_cd = #{categoryCd},</if>
        <if test="brandName != null and brandName != ''">brand_name = #{brandName},</if>
        <if test="brandDescription != null and brandDescription != ''">brand_description = #{brandDescription},</if>
        <if test="visible != null and visible != ''">visible = #{visible},</if>
        <if test="updater != null and updater != ''">updater = #{updater},</if>
        update_time = NOW()
        WHERE brand_seq = #{brandSeq}
    </update>

    <insert id="addBrand" parameterType="brandVo" useGeneratedKeys="true" keyProperty="brandSeq">
        /* [AdminBrand_SQL.xml].[addBrand] */
        INSERT INTO app_board_brand
        (
            category_cd
        , brand_name
        , brand_description
        , visible
        , creator
        , create_time
        , updater
        , update_time
        )
        VALUES
        (
            #{categoryCd}
        , #{brandName}
        , #{brandDescription}
        , #{visible}
        , #{updater}
        , now()
        , #{updater}
        , now()
        )
    </insert>

    <select id="selectLatestFileId" resultType="java.lang.String">
        /* [AdminBrand_SQL.xml].[selectLatestFileId] */
        SELECT FILE_ID FROM J_ATTACHFILE ORDER BY REG_DATE DESC LIMIT 1
    </select>

    <!--    <insert id="addImageFileInfo" parameterType="app.cmm.imageFile.service.ImageFileVo">-->
    <!--        /* [AdminBrand_SQL.xml].[addImageFileInfo] */-->
    <!--        INSERT INTO app_image_file_info-->
    <!--        (-->
    <!--            board_type_cd-->
    <!--        , board_seq-->
    <!--        , image_type_cd-->
    <!--        , image_file_id-->
    <!--        , image_file_seq-->
    <!--        , sort_order-->
    <!--        , visible-->
    <!--        , creator-->
    <!--        , create_time-->
    <!--        , updater-->
    <!--        , update_time-->
    <!--        )-->
    <!--        VALUES-->
    <!--        (-->
    <!--            #{boardTypeCd}-->
    <!--        , #{boardSeq}-->
    <!--        , #{imageTypeCd}-->
    <!--        , #{imageFileId}-->
    <!--        , #{imageFileSeq}-->
    <!--        , #{sortOrder}-->
    <!--        , #{visible}-->
    <!--        , #{updater}-->
    <!--        , NOW()-->
    <!--        , #{updater}-->
    <!--        , NOW()-->
    <!--        )-->
    <!--    </insert>-->

    <!--    <update id="modifyImageFileInfo" parameterType="app.cmm.imageFile.service.ImageFileVo">-->
    <!--        /* [AdminBrand_SQL.xml].[modifyImageFileInfo] */-->
    <!--        UPDATE app_image_file_info-->
    <!--        SET-->
    <!--        <if test="boardTypeCd != null and boardTypeCd != ''">board_type_cd = #{boardTypeCd},</if>-->
    <!--        <if test="boardSeq != null and boardSeq != ''">board_seq = #{boardSeq},</if>-->
    <!--        <if test="imageTypeCd != null and imageTypeCd != ''">image_type_cd = #{imageTypeCd},</if>-->
    <!--        <if test="imageFileId != null and imageFileId != ''">image_file_id = #{imageFileId},</if>-->
    <!--        <if test="imageFileSeq != null and imageFileSeq != ''">image_file_seq = #{imageFileSeq},</if>-->
    <!--        <if test="sortOrder != null and sortOrder != ''">sort_order = #{sortOrder},</if>-->
    <!--        <if test="visible != null and visible != ''">visible = #{visible},</if>-->
    <!--        <if test="updater != null and updater != ''">updater = #{updater},</if>-->
    <!--        update_time = NOW()-->
    <!--        <where>-->
    <!--            <if test="imageFileInfoSeq != null and imageFileInfoSeq != ''">AND image_file_info_seq = #{imageFileInfoSeq}</if>-->
    <!--            <if test="boardTypeCd != null and boardTypeCd != ''">AND board_type_cd = #{boardTypeCd}</if>-->
    <!--            <if test="boardSeq != null and boardSeq != ''">AND board_seq = #{boardSeq}</if>-->
    <!--            <if test="imageTypeCd != null and imageTypeCd != ''">AND image_type_cd = #{imageTypeCd}</if>-->
    <!--            <if test="sortOrder != null and sortOrder != ''">AND sort_order = #{sortOrder}</if>-->
    <!--        </where>-->
    <!--    </update>-->

    <!--    <insert id="addUrlLink" parameterType="app.cmm.urlLink.service.UrlLinkVo">-->
    <!--        /* [AdminBrand_SQL.xml].[addUrlLink] */-->
    <!--        INSERT INTO app_url_link_info-->
    <!--        (-->
    <!--            board_type_cd-->
    <!--        , board_seq-->
    <!--        , link_type_cd-->
    <!--        , link_address-->
    <!--        , sort_order-->
    <!--        , visible-->
    <!--        , creator-->
    <!--        , create_time-->
    <!--        , updater-->
    <!--        , update_time-->
    <!--        )-->
    <!--        VALUES-->
    <!--        (-->
    <!--            #{boardTypeCd}-->
    <!--        , #{boardSeq}-->
    <!--        , #{linkTypeCd}-->
    <!--        , #{linkAddress}-->
    <!--        , #{sortOrder}-->
    <!--        , #{visible}-->
    <!--        , #{updater}-->
    <!--        , NOW()-->
    <!--        , #{updater}-->
    <!--        , NOW()-->
    <!--        )-->
    <!--    </insert>-->

    <!--    <update id="modifyUrlLink" parameterType="app.cmm.urlLink.service.UrlLinkVo">-->
    <!--        /* [AdminBrand_SQL.xml].[modifyUrlLink] */-->
    <!--        UPDATE app_url_link_info-->
    <!--        SET-->
    <!--        <if test="boardTypeCd != null and boardTypeCd != ''">board_type_cd = #{boardTypeCd},</if>-->
    <!--        <if test="boardSeq != null and boardSeq != ''">board_seq = #{boardSeq},</if>-->
    <!--        <if test="linkTypeCd != null and linkTypeCd != ''">link_type_cd = #{linkTypeCd},</if>-->
    <!--        <if test="linkAddress != null and linkAddress != ''">link_address = #{linkAddress},</if>-->
    <!--        <if test="sortOrder != null and sortOrder != ''">sort_order = #{sortOrder},</if>-->
    <!--        <if test="visible != null and visible != ''">visible = #{visible},</if>-->
    <!--        <if test="updater != null and updater != ''">updater = #{updater},</if>-->
    <!--        update_time = NOW()-->
    <!--        <where>-->
    <!--            <if test="linkSeq != null and linkSeq != ''">AND link_seq = #{linkSeq}</if>-->
    <!--            <if test="boardTypeCd != null and boardTypeCd != ''">AND board_type_cd = #{boardTypeCd}</if>-->
    <!--            <if test="boardSeq != null and boardSeq != ''">AND board_seq = #{boardSeq}</if>-->
    <!--            <if test="linkTypeCd != null and linkTypeCd != ''">AND link_type_cd = #{linkTypeCd}</if>-->
    <!--        </where>-->
    <!--    </update>-->

    <select id="getCodeList" parameterType="codeVo" resultType="snsInfoVo">
        /* [AdminBrand_SQL.xml].[getCodeList] */
        SELECT
        a.code_id       as codeId
        , a.code_name   as codeName
        , a.code_value  as codeValue
        , a.description as codeDesc
        , a.parent_cd   as parentCd
        , a.property1   as property1
        , a.property2   as property2
        , a.property3   as property3
        , a.sort_order  as sortOrder
        , a.visible     as visible
        , a.creator     as creator
        , (select name from app_user_info where user_seq = 1) as creatorName
        , DATE_FORMAT(a.create_time, '%Y-%m-%d') as createTime
        , a.updater     as updater
        , DATE_FORMAT(a.update_time, '%Y-%m-%d') as updateTime
        , (select FILE_NAME from J_ATTACHFILE where file_id = a.property1) as fileName
        , (select FILE_PATH from J_ATTACHFILE where file_id = a.property1) as filePath
        FROM app_code a
        WHERE parent_cd = #{parentCd}
        <if test='parentCd == "lnkt002" or visible == "Y"'>
            AND visible = 'Y'
        </if>
        <if test="codeId != null and codeId != ''">
            AND a.code_id = #{codeId}
        </if>
        <choose>
            <when test="parentCd == 'lnkt002'">
                ORDER BY sortOrder DESC
            </when>
            <otherwise>
                ORDER BY sortOrder
            </otherwise>
        </choose>
    </select>

    <!--    <select id="getCodeListCnt" parameterType="app.cmm.service.CodeVo" resultType="java.lang.Integer">-->
    <!--        /* [AdminBrand_SQL.xml].[getCodeListCnt] */-->
    <!--        SELECT count(*) totCnt-->
    <!--        FROM app_code a-->
    <!--        WHERE parent_cd = #{parentCd}-->
    <!--        <if test='parentCd == "lnkt002" or visible == "Y"'>-->
    <!--            AND visible = 'Y'-->
    <!--        </if>-->
    <!--        <if test="codeId != null and codeId != ''">-->
    <!--            AND a.code_id = #{codeId}-->
    <!--        </if>-->
    <!--    </select>-->

    <!--    <update id="modifyCode" parameterType="app.cmm.service.CodeVo">-->
    <!--        /* [AdminBrand_SQL.xml].[modifyCode] */-->
    <!--        UPDATE app_code-->
    <!--        SET-->
    <!--        <if test="codeName != null and codeName != ''">code_name = #{codeName},</if>-->
    <!--        <if test="codeValue != null and codeValue != ''">code_value = #{codeValue},</if>-->
    <!--        <if test="codeDesc != null and codeDesc != ''">description = #{codeDesc},</if>-->
    <!--        <if test="parentCd != null and parentCd != ''">parent_cd = #{parentCd},</if>-->
    <!--        <if test="property1 != null and property1 != ''">property1 = #{property1},</if>-->
    <!--        <if test="property2 != null and property2 != ''">property2 = #{property2},</if>-->
    <!--        <if test="property3 != null and property3 != ''">property3 = #{property3},</if>-->
    <!--        <if test="sortOrder != null and sortOrder != ''">sort_order = #{sortOrder},</if>-->
    <!--        <if test="visible != null and visible != ''">visible = #{visible},</if>-->
    <!--        <if test="updater != null and updater != ''">updater = #{updater},</if>-->
    <!--        update_time = NOW()-->
    <!--        WHERE code_id = #{codeId}-->
    <!--    </update>-->

    <!--    <insert id="addCode" parameterType="app.cmm.service.CodeVo" useGeneratedKeys="true" keyProperty="codeId">-->
    <!--        /* [AdminBrand_SQL.xml].[addCode] */-->
    <!--        INSERT INTO app_code-->
    <!--        (-->
    <!--            code_id-->
    <!--        , code_name-->
    <!--        , code_value-->
    <!--        , description-->
    <!--        , parent_cd-->
    <!--        , property1-->
    <!--        , property2-->
    <!--        , property3-->
    <!--        , sort_order-->
    <!--        , visible-->
    <!--        , creator-->
    <!--        , create_time-->
    <!--        , updater-->
    <!--        , update_time-->
    <!--        )-->
    <!--        VALUES-->
    <!--        (-->
    <!--            (select concat('lnkt', lpad(right(code_id, 3) + 1, 3, '0')) from app_code a where parent_cd = 'lnkt002' order by code_id desc limit 1)-->
    <!--             , #{codeName}-->
    <!--             , #{codeValue}-->
    <!--             , #{codeDesc}-->
    <!--             , #{parentCd}-->
    <!--             , #{property1}-->
    <!--             , #{property2}-->
    <!--             , #{property3}-->
    <!--             , (select sort_order + 1 from app_code b where parent_cd = 'lnkt002' order by code_id desc limit 1)-->
    <!--             , 'Y'-->
    <!--             , #{updater}-->
    <!--             , NOW()-->
    <!--             , #{updater}-->
    <!--             , NOW()-->
    <!--            )-->
    <!--    </insert>-->

    <!--    <select id="getLatestSnsId" resultType="java.lang.String">-->
    <!--        /* [AdminBrand_SQL.xml].[getLatestSnsId] */-->
    <!--        SELECT code_id-->
    <!--        FROM app_code-->
    <!--        WHERE parent_cd = #{parentCd}-->
    <!--        ORDER BY code_id DESC-->
    <!--            LIMIT 1-->
    <!--    </select>-->

    <!--    <select id="getSnsLinkList" resultType="app.cmm.urlLink.service.UrlLinkVo">-->
    <!--        /* [AdminBrand_SQL.xml].[getSnsLinkList] */-->
    <!--        SELECT-->
    <!--        A.code_name snsName-->
    <!--        , B.link_seq-->
    <!--        , B.board_type_cd-->
    <!--        , B.board_seq-->
    <!--        , IFNULL(B.link_type_cd,A.code_id) as linkTypeCd-->
    <!--        , B.link_address-->
    <!--        , B.sort_order-->
    <!--        , B.visible-->
    <!--        , B.creator-->
    <!--        , B.create_time-->
    <!--        , B.updater-->
    <!--        , B.update_time-->
    <!--        , C.FILE_ID-->
    <!--        , C.FILE_NAME-->
    <!--        , C.FILE_PATH-->
    <!--        FROM app_code A-->
    <!--        LEFT OUTER JOIN app_url_link_info B ON A.code_id = B.link_type_cd-->
    <!--        AND B.board_seq = #{boardSeq}-->
    <!--        AND B.board_type_cd = #{boardTypeCd}-->
    <!--        AND B.link_type_cd NOT IN ('lnkt001', 'lnkt002')-->
    <!--        LEFT OUTER JOIN J_ATTACHFILE C ON A.property1 = C.FILE_ID-->
    <!--        WHERE A.parent_cd = 'lnkt002'-->
    <!--        <if test="codeVisible != null and codeVisible != ''">-->
    <!--            AND A.visible = #{codeVisible}-->
    <!--        </if>-->
    <!--        <if test="visible != null and visible != ''">-->
    <!--            AND B.visible = #{visible}-->
    <!--        </if>-->
    <!--        ORDER BY A.sort_order-->
    <!--    </select>-->
</mapper>
